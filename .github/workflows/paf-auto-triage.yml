name: PAF Auto-Triage

on:
  issues:
    types: [opened, labeled]

permissions:
  issues: write
  repository-projects: write

jobs:
  auto-triage:
    runs-on: ubuntu-latest
    steps:
      - name: Add to Sprint Board (default)
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ vars.PAF_SPRINT_BOARD_URL }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'finding') ||
          contains(github.event.issue.labels.*.name, 'task') ||
          contains(github.event.issue.labels.*.name, 'bug')
        continue-on-error: true

      - name: Add to Security Board
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ vars.PAF_SECURITY_BOARD_URL }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'security') ||
          contains(github.event.issue.labels.*.name, 'ğŸ”’ alex') ||
          contains(github.event.issue.labels.*.name, 'ğŸ” scanner')
        continue-on-error: true

      - name: Add to Tech Debt Board
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ vars.PAF_TECHDEBT_BOARD_URL }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'tech-debt') ||
          contains(github.event.issue.labels.*.name, 'ğŸ”§ max')
        continue-on-error: true

      - name: Add to Architecture Board
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ vars.PAF_ARCH_BOARD_URL }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'adr') ||
          contains(github.event.issue.labels.*.name, 'architecture') ||
          contains(github.event.issue.labels.*.name, 'ğŸ”€ david') ||
          contains(github.event.issue.labels.*.name, 'ğŸ›ï¸ sophia')
        continue-on-error: true

      - name: Add to Bug Tracker
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ vars.PAF_BUG_BOARD_URL }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'incident') ||
          contains(github.event.issue.labels.*.name, 'ğŸš¨ inci') ||
          contains(github.event.issue.labels.*.name, 'ğŸ§ª tina') ||
          contains(github.event.issue.labels.*.name, 'ğŸ’¬ feedback')
        continue-on-error: true

      - name: Add to Product Backlog
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ vars.PAF_BACKLOG_BOARD_URL }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'feature') ||
          contains(github.event.issue.labels.*.name, 'epic') ||
          contains(github.event.issue.labels.*.name, 'ğŸ’¡ ava') ||
          contains(github.event.issue.labels.*.name, 'ğŸ“ maya')
        continue-on-error: true

      - name: Comment on P0 Issues
        uses: actions/github-script@v7
        if: contains(github.event.issue.labels.*.name, 'P0')
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'âš ï¸ **P0 - Critical Priority**\n\nThis issue has been marked as critical and requires immediate attention.\n\n_Auto-generated by PAF Auto-Triage_'
            })
